@model InvoiceCheck
@{
    ViewData["Title"] = "Check";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="text-center">
    <form asp-action="Check">
        <div class="input-group mb-3" name="div-group">
            <span class="input-group-text" id="grouplbl">التبعيّة</span>
            <input name="group-hidden" type="hidden" value="@ViewData["group"]">
            <select name="group" type="text" class="form-select" aria-label="grouplbl" aria-describedby="grouplbl" asp-for="Group" required>
                <option value="kfrseer">كفرصير</option>
                <option value="majdal">مجدل سلم</option>
                <option value="ayta">عيتا</option>
                <option value="kana">قانا</option>
                <option value="mawla">اشتراك المولى</option>
            </select>
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="clientidlbl">رمز المستخدم</span>
            <input class="form-control" aria-label="clientidlbl" aria-describedby="clientidlbl" asp-for="CustId" value="@ViewData["CustId"]" required />
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="yearlbl">السنة</span>
            <select class="form-select" aria-label="yearlbl" aria-describedby="yearlbl" asp-for="Year" required>
                @{
                    for (int i = 2023; i < 2040; i++)
                    {
                        <option value="@i">@i</option>
                    }
                }
            </select>
        </div>
        <div class="input-group mb-3">
            <span class="input-group-text" id="monthlbl">الشهر</span>
            <select class="form-select" aria-label="monthlbl" aria-describedby="monthlbl" asp-for="Month" required>
                @{
                    for (int i = 1; i <= 12; i++)
                    {
                        <option value="@i">@i</option>
                    }
                }
            </select>
        </div>
        <input type="submit" value="طلب الفاتورة" class="btn btn-primary" />
        <div class="text-danger" style="margin-top: 20px;">@ViewData["error"]</div>
    </form>

    <div class="text-primary" style="margin-top: 20px;">
        @if (@ViewData["data"] != null)
        {
            <table class="table table-striped" style="border: 1px solid #dee2e6;">
                <tbody>
                    @foreach (var k in ((Dictionary<string, string>)@ViewData["data"]).Keys)
                    {
                        <tr>
                            <td style="font-weight: bold;">@k</td>
                            <td>@(((Dictionary<string, string>)ViewData["data"]).GetValueOrDefault(k))</td>
                        </tr>
                    }
                </tbody>
            </table>
        }
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script>
        $(document).ready(function () {
            $('[name="group"]').on('change', () => {
                Cookies.set('group', $('[name="group"]').val());
            });
            $('#CustId').on('change', () => {
                Cookies.set('CustId', $('#CustId').val());
            });
            var group = $('[name="group-hidden"]').val();
            if (group == null || group.trim().length == 0) {
                group = Cookies.get('group');
            }

            if (group != null && group.trim().length > 0) {
                $('[name="group"]').val(group);
            }
            var CustId = Cookies.get('CustId');
            if (CustId != null && CustId.trim().length > 0 && ($('#CustId').val() == null || $('#CustId').val().trim().length == 0)) {
                $('#CustId').val(CustId);
            }
        });
    </script>
}

